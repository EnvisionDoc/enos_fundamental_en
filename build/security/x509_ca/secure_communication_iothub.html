

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en-us" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en-us" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Best practice for securing communications between edge gateways and EnOS IoT Hub with X.509 certificates &mdash; EnOS Documentation Center 1 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/language_data.js"></script>
    

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <!-- <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" /> -->
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Creating your Certificate Signing Request (CSR) file" href="creating_csr.html" />
    <link rel="prev" title="How to get root CA certificate and CRL" href="using_ca_service_api.html" /> 
</head>

<body id='root'>
  <div id="header"></div>
   
  <div class="enos-doc">

    
    <nav data-toggle="enos-nav-shift" class="enos-doc-side">
    <div class="enos-doc-side-scroll">
    <div class="enos-doc-toc" data-spy="affix" role="navigation" aria-label="main navigation">
        <div class="enos-doc-search">
            
                
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input class="search-input" type="text" name="q" placeholder="Search this document" />
    <span class="icon-search"></span>
    <span class="icon-wrong_small"></span>
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
            
        </div>
        
            
            
            
            
            <p class="caption"><span class="caption-text">Overview</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../overview/enos_introduction.html">EnOS Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../overview/technical_architecture.html">EnOS Technical Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../overview/enos_gettingstarted.html">Getting Started with EnOS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../overview/accessing_enos.html">Accessing EnOS</a></li>
<li class="toctree-l1"><a class="reference external" href="/docs/iam/en/latest/iam_overview.html">Identity and Access Management</a></li>
</ul>
<p class="caption"><span class="caption-text">EnOS Services and Functions</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="/docs/enos-edge/en/latest/edge_overview.html">EnOS Edge</a></li>
<li class="toctree-l1"><a class="reference external" href="/docs/device-connection/en/latest/device_management_overview.html">Device Management</a></li>
<li class="toctree-l1"><a class="reference external" href="/docs/event-management/en/latest/alert_overview.html">Alert Service</a></li>
<li class="toctree-l1"><a class="reference external" href="/docs/offline-data/en/latest/gettingstarted.html">Offline Analytics</a></li>
<li class="toctree-l1"><a class="reference external" href="/docs/data-explorer/en/latest/dataexplorer_overview.html">Data Explorer</a></li>
<li class="toctree-l1"><a class="reference external" href="/docs/analysis-report/en/latest/report_overview.html">Analytics and Report</a></li>
<li class="toctree-l1"><a class="reference external" href="/docs/app-development/en/latest/app_dev_overview.html">Application Development</a></li>
</ul>
<p class="caption"><span class="caption-text">Security</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../security_overview.html">Security Overview</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">X.509 Certificate Service in EnOS</a></li>
</ul>
<p class="caption"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../reference/glossary.html">EnOS Glossaries</a></li>
</ul>

            
        
    </div>
</div>
<!-- read the docs versions -->
<div class="versions">
  
</div>
    </nav>

    <section data-toggle="enos-nav-shift" class="enos-doc-content">
      <div class="enos-doc-content-body">
          
          <div class="rst-content">
          
            <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div itemprop="articleBody">
              

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="breadcrumbs">
    
      <li><a href="/dev-center/documentation.html">Documentation</a><span class="icon-right"></span></li>
        
          <li><a href="index.html">X.509 Certificate Service in EnOS</a><span class="icon-right"></span</li>
        
      <li>Best practice for securing communications between edge gateways and EnOS IoT Hub with X.509 certificates</li>
    
    
      <li class="breadcrumbs-aside">
        
            
            <a href="../../_sources/security/x509_ca/secure_communication_iothub.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>
</div>
              
  <div class="section" id="best-practice-for-securing-communications-between-edge-gateways-and-enos-iot-hub-with-x-509-certificates">
<h1>Best practice for securing communications between edge gateways and EnOS IoT Hub with X.509 certificates<a class="headerlink" href="#best-practice-for-securing-communications-between-edge-gateways-and-enos-iot-hub-with-x-509-certificates" title="Permalink to this headline">¶</a></h1>
<p>Security is a critical in an IoT system. EnOS enforces the following security schemes for secure the connection between the edge gateway and EnOS IoT Hub:</p>
<ul class="simple">
<li>The communications between the edge gateway and EnOS IoT Hub are enforced to use certificate-based bi-directional authentication.</li>
<li>Support for RSA algorithm to verify signature, with enforcement for 2048 bits.</li>
<li>The resource on EnOS is segregated and the API access permissions are controlled by IAM, for more information, see <a class="reference external" href="/docs/iam/en/latest/iam_overview.html">IAM overview</a>.</li>
</ul>
<div class="section" id="setup-phase">
<h2>Setup phase<a class="headerlink" href="#setup-phase" title="Permalink to this headline">¶</a></h2>
<p>The following diagram illustrates the process of secure communication between the edge and IoT Hub based on X.509 certificates:</p>
<a class="reference internal image-reference" href="../../_images/certificate_service_secure_communication_01.png"><img alt="../../_images/certificate_service_secure_communication_01.png" src="../../_images/certificate_service_secure_communication_01.png" style="width: 400px;" /></a>
<div class="section" id="iot-hub-acquires-x-509-certificate">
<h3>1. IoT Hub acquires X.509 certificate<a class="headerlink" href="#iot-hub-acquires-x-509-certificate" title="Permalink to this headline">¶</a></h3>
<p>1a. The IoT Hub creates key pairs and CSR locally, acquires the X.509 certificate with the CSR by using the X.509 Certificate Service API.</p>
<p>1b. The EnOS CA issues the X.509 certificate and sends the certificate to the IoT Hub.</p>
<p>1c. The IoT Hub receives and stores the X.509 certificate.</p>
<a class="reference internal image-reference" href="../../_images/certificate_service_secure_communication_02.png"><img alt="../../_images/certificate_service_secure_communication_02.png" src="../../_images/certificate_service_secure_communication_02.png" style="width: 400px;" /></a>
</div>
<div class="section" id="edge-acquires-x-509-certificate">
<h3>2. Edge acquires X.509 certificate<a class="headerlink" href="#edge-acquires-x-509-certificate" title="Permalink to this headline">¶</a></h3>
<p>2a. <em>The device provisioner</em> provisions the edge with necessary information such as product key, product secret, serial number, and license. The provisioner uses these parameters to create the device in the IoT Hub.</p>
<p>2b. The IoT Hub verifies the identity of the edge and creates the device instance in the Hub, responds to Edge with the Globally Unique Identifier (GUID) of the device and the device secret.</p>
<p>2c. The edge receives the responses from the IoT Hub, creates key pairs and CSR, calls the API to activate the device, and gets its X.509 certificate.</p>
<p>2d. The IoT Hub receives the request from the edge, after verifying its identity, activates the device and forward the CSR to the EnOS CA.</p>
<p>2e. The EnOS CA receives the CSR, issues the certificate and responds to the IoT Hub.</p>
<p>2f. The IoT Hub receives the issued X.509 certificate, binds it with the device id, and then sends the certificate to the edge.</p>
<p>2g.The edge receives the issued X.509 certificate, saves it securely in the local repository.</p>
</div>
</div>
<div class="section" id="communication-phase">
<h2>Communication phase<a class="headerlink" href="#communication-phase" title="Permalink to this headline">¶</a></h2>
<p>The diagram below illustrates the certificate-based authentication process and the revocation process:</p>
<a class="reference internal image-reference" href="../../_images/certificate_service_secure_communication_03.png"><img alt="../../_images/certificate_service_secure_communication_03.png" src="../../_images/certificate_service_secure_communication_03.png" style="width: 400px;" /></a>
<div class="section" id="edge-communicates-with-the-iot-hub-using-the-certificate-based-bi-directional-authentication">
<h3>3. Edge communicates with the IoT Hub using the certificate-based bi-directional authentication<a class="headerlink" href="#edge-communicates-with-the-iot-hub-using-the-certificate-based-bi-directional-authentication" title="Permalink to this headline">¶</a></h3>
<p>3a. The edge validates the certificate of the IoT Hub.</p>
<p>3b. The IoT Hub validates the certificate of the edge.</p>
<p>When the TLS handshake in step 3a and 3b succeeds, the TLS connection is established between the edge and the IoT Hub.</p>
<p>3c. The edge transmits device telemetry through MQTT over the TLS connection.</p>
<p>3d. The IoT Hub transmits configurations and control signals through MQTT over the TLS connection.</p>
<a class="reference internal image-reference" href="../../_images/certificate_service_secure_communication_04.png"><img alt="../../_images/certificate_service_secure_communication_04.png" src="../../_images/certificate_service_secure_communication_04.png" style="width: 400px;" /></a>
</div>
</div>
<div class="section" id="revocation-phase">
<h2>Revocation phase<a class="headerlink" href="#revocation-phase" title="Permalink to this headline">¶</a></h2>
<p>Under some circumstances, the <em>device provisioner</em> needs to revoke the X.509 certificate of the edge.</p>
<div class="section" id="the-iot-hub-revokes-the-x-509-certificate-of-the-edge">
<h3>4. The IoT Hub revokes the X.509 certificate of the Edge<a class="headerlink" href="#the-iot-hub-revokes-the-x-509-certificate-of-the-edge" title="Permalink to this headline">¶</a></h3>
<p>4a. The IoT Hub calls the revocation API to revoke the X.509 certificate with the serial number of the certificate.</p>
<p>4b. The EnOS CA receives the request from the IoT Hub, verifies the identity, revokes the certificate, and update the CRL.</p>
</div>
</div>
<div class="section" id="edge-security-best-practices">
<h2>Edge security best practices<a class="headerlink" href="#edge-security-best-practices" title="Permalink to this headline">¶</a></h2>
<p>In the certificate-based security connection, consider the following best practices to secure the edge:</p>
<ul class="simple">
<li>Create the private key for the edge and keep it secret in a storage such as TPM.</li>
<li>Use TLS 1.2 when communicating with the IoT Hub and verify that the server certificate is valid.</li>
<li>Each edge must have a unique public/private key pair.</li>
<li>The key pair used to be authenticated by IoT Hub should not be used for other purposes or communications through other protocols.</li>
<li>The key must be revoked when the edge is reset.</li>
<li>When your edge runs on an operating system, make sure your operating system is secured through certain mechanisms, for example, firewall.</li>
<li>Ensure that you have a way to update root CA certificates and CRL.</li>
<li>Ensure that the clock on the edge is not tampered with.</li>
</ul>
</div>
</div>


            </div>
            
            </div>
            <footer>
  
    <div class="enos-footer-nav" role="navigation" aria-label="footer navigation">
      
        <a href="using_ca_service_api.html" class="prev" title="How to get root CA certificate and CRL" accesskey="p" rel="prev"><span class="icon-right"></span> Previous</a>
      
      
        <a href="creating_csr.html" class="next" title="Creating your Certificate Signing Request (CSR) file" accesskey="n" rel="next">Next <span class="icon-right"></span></a>
      
    </div>
   

</footer>

          </div>
        <div class="enos-doc-local-toc">
          <div class="toc">
            <ul>
<li><a class="reference internal" href="#">Best practice for securing communications between edge gateways and EnOS IoT Hub with X.509 certificates</a><ul>
<li><a class="reference internal" href="#setup-phase">Setup phase</a><ul>
<li><a class="reference internal" href="#iot-hub-acquires-x-509-certificate">1. IoT Hub acquires X.509 certificate</a></li>
<li><a class="reference internal" href="#edge-acquires-x-509-certificate">2. Edge acquires X.509 certificate</a></li>
</ul>
</li>
<li><a class="reference internal" href="#communication-phase">Communication phase</a><ul>
<li><a class="reference internal" href="#edge-communicates-with-the-iot-hub-using-the-certificate-based-bi-directional-authentication">3. Edge communicates with the IoT Hub using the certificate-based bi-directional authentication</a></li>
</ul>
</li>
<li><a class="reference internal" href="#revocation-phase">Revocation phase</a><ul>
<li><a class="reference internal" href="#the-iot-hub-revokes-the-x-509-certificate-of-the-edge">4. The IoT Hub revokes the X.509 certificate of the Edge</a></li>
</ul>
</li>
<li><a class="reference internal" href="#edge-security-best-practices">Edge security best practices</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      <!-- footer --> 
  
      <div id="footer"></div>
    </section>
    
  </div>
  <!-- if you are developing this theme, please change next line to  -->
  <!-- <script type="text/javascript" src="../../_static/js/theme.js"></script> -->
  <!-- end if -->
  <script type="text/javascript" src="../../_static/js/theme.8115fa7dbc259f703b8e.js"></script>

</body>
</html>